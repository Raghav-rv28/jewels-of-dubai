{% doc %}
  Product Card Component for Jewelry Store
  
  Renders a product card with customizable options for jewelry display.
  
  @param {product} product - Product object (required)
  @param {string} [image_ratio] - Image aspect ratio (default: 'square')
  @param {boolean} [show_vendor] - Show vendor name (default: false)
  @param {boolean} [show_quick_add] - Show quick add button (default: true)
  @param {boolean} [show_badges] - Show product badges (default: true)
  @param {string} [card_class] - Additional CSS classes
  
  @example
  {% render 'product-card',
       product: product,
       show_vendor: true,
       image_ratio: 'square'
    %}
{% enddoc %}

{% liquid
  assign image_ratio = image_ratio | default: 'square'
  assign show_vendor = show_vendor | default: false
  assign show_quick_add = show_quick_add | default: true
  assign show_badges = show_badges | default: true
  assign card_class = card_class | default: ''
  
  # Early return if required parameters missing
  unless product != empty
    echo '<!-- Error: product parameter required for product-card snippet -->'
    break
  endunless
%}

<div class="product-card {{ card_class }}" style="--image-ratio: {{ image_ratio }}">
  <div class="product-card__image">
    {% if product.featured_image %}
      {% render 'image',
        image: product.featured_image,
        url: product.url,
        width: 400,
        height: 400,
        crop: 'center',
        class: 'product-card__image-element'
      %}
    {% else %}
      <div class="product-card__placeholder">
        {{ 'product-1' | placeholder_svg_tag: 'product-card__placeholder-svg' }}
      </div>
    {% endif %}
    
    <!-- Product Badges -->
    {% if show_badges %}
      <div class="product-card__badges">
        {% if product.compare_at_price > product.price %}
          <span class="product-card__badge product-card__badge--sale">
            {{ 'products.on_sale' | t }}
          </span>
        {% endif %}
        
        {% assign is_new = false %}
        {% for tag in product.tags %}
          {% if tag == 'new' %}
            {% assign is_new = true %}
            {% break %}
          {% endif %}
        {% endfor %}
        
        {% if is_new %}
          <span class="product-card__badge product-card__badge--new">
            {{ 'products.new' | t }}
          </span>
        {% endif %}
        
        {% unless product.available %}
          <span class="product-card__badge product-card__badge--sold-out">
            {{ 'products.sold_out' | t }}
          </span>
        {% endunless %}
      </div>
    {% endif %}
    
    <!-- Quick Add Button -->
    {% if show_quick_add and product.available %}
      <div class="product-card__quick-add">
        <button class="btn btn--primary btn--small product-card__quick-add-button" 
                data-product-id="{{ product.id }}"
                data-variant-id="{{ product.selected_or_first_available_variant.id }}">
          {{ 'products.quick_add' | t }}
        </button>
      </div>
    {% endif %}
  </div>
  
  <div class="product-card__content">
    {% if show_vendor and product.vendor != blank %}
      <p class="product-card__vendor">{{ product.vendor | escape }}</p>
    {% endif %}
    
    <h3 class="product-card__title">
      <a href="{{ product.url }}" class="product-card__title-link">
        {{ product.title | escape }}
      </a>
    </h3>
    
    <div class="product-card__price">
      {% render 'price', product: product %}
    </div>
  </div>
</div>

{% stylesheet %}
  .product-card {
    position: relative;
    border-radius: var(--border-radius);
    overflow: hidden;
    transition: var(--transition-normal);
    box-shadow: var(--shadow-sm);
    background-color: var(--color-background);
  }
  
  .product-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }
  
  .product-card__image {
    position: relative;
    aspect-ratio: var(--image-ratio, 1);
    overflow: hidden;
    background-color: #f8f9fa;
  }
  
  .product-card__image-element {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: var(--transition-normal);
  }
  
  .product-card:hover .product-card__image-element {
    transform: scale(1.05);
  }
  
  .product-card__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f8f9fa;
  }
  
  .product-card__placeholder-svg {
    width: 60%;
    height: 60%;
    opacity: 0.3;
  }
  
  .product-card__badges {
    position: absolute;
    top: var(--spacing-sm);
    left: var(--spacing-sm);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
    z-index: 2;
  }
  
  .product-card__badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .product-card__badge--sale {
    background-color: #dc3545;
    color: white;
  }
  
  .product-card__badge--new {
    background-color: var(--color-primary);
    color: white;
  }
  
  .product-card__badge--sold-out {
    background-color: #6c757d;
    color: white;
  }
  
  .product-card__quick-add {
    position: absolute;
    bottom: var(--spacing-sm);
    left: var(--spacing-sm);
    right: var(--spacing-sm);
    opacity: 0;
    transform: translateY(10px);
    transition: var(--transition-normal);
    z-index: 2;
  }
  
  .product-card:hover .product-card__quick-add {
    opacity: 1;
    transform: translateY(0);
  }
  
  .product-card__quick-add-button {
    width: 100%;
    font-size: 0.875rem;
    padding: var(--spacing-sm);
  }
  
  .product-card__content {
    padding: var(--spacing-md);
  }
  
  .product-card__vendor {
    color: var(--color-secondary);
    font-size: 0.875rem;
    font-weight: 500;
    margin: 0 0 var(--spacing-xs) 0;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .product-card__title {
    margin: 0 0 var(--spacing-sm) 0;
    font-size: 1rem;
    font-weight: 500;
    line-height: 1.3;
  }
  
  .product-card__title-link {
    color: var(--color-foreground);
    text-decoration: none;
    transition: var(--transition-fast);
  }
  
  .product-card__title-link:hover {
    color: var(--color-primary);
  }
  
  .product-card__price {
    font-weight: 600;
  }
  
  /* Mobile adjustments */
  @media (max-width: 767px) {
    .product-card__quick-add {
      opacity: 1;
      transform: translateY(0);
    }
    
    .product-card:hover {
      transform: none;
    }
    
    .product-card:hover .product-card__image-element {
      transform: none;
    }
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    // Quick add functionality
    const quickAddButtons = document.querySelectorAll('.product-card__quick-add-button');
    const quickAddText = 'Quick add';
    
    quickAddButtons.forEach(button => {
      button.addEventListener('click', function(e) {
        e.preventDefault();
        
        const productId = this.dataset.productId;
        const variantId = this.dataset.variantId;
        
        if (!productId || !variantId) return;
        
        // Add to cart logic
        fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            id: variantId,
            quantity: 1
          })
        })
        .then(response => response.json())
        .then(data => {
          // Update cart count in header
          const cartCount = document.querySelector('.header__cart-count');
          if (cartCount) {
            // Trigger cart update event
            document.dispatchEvent(new CustomEvent('cart:updated'));
          }
          
          // Show success feedback
          this.textContent = 'Added!';
          this.style.backgroundColor = '#28a745';
          
          setTimeout(() => {
            this.textContent = quickAddText;
            this.style.backgroundColor = '';
          }, 2000);
        })
        .catch(error => {
          console.error('Error adding to cart:', error);
          this.textContent = 'Error';
          this.style.backgroundColor = '#dc3545';
          
          setTimeout(() => {
            this.textContent = quickAddText;
            this.style.backgroundColor = '';
          }, 2000);
        });
      });
    });
  });
{% endjavascript %}
